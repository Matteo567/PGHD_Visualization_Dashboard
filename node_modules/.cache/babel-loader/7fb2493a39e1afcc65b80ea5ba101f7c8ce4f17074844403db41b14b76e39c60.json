{"ast":null,"code":"/**\n MoodCalendar.js - Mood Tracking Calendar Visualization\n \n This component provides comprehensive mood monitoring:\n - Daily mood tracking in calendar format\n - Color-coded mood states (happy, sad, angry)\n - Monthly navigation and trend analysis\n - Interactive mood selection and editing\n - Calendar layout\n - Integration with patient data and navigation\n \n Essential for mental health monitoring and emotional well-being tracking.\n */import React,{useState,useRef}from'react';import usePatientData from'../../hooks/usePatientData';import useChartNavigation from'../../hooks/useChartNavigation';import Legend from'../Legend';import'./MoodCalendar.css';// --- Constants & Config ---\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MOODS={happy:'ðŸ˜Š',sad:'ðŸ˜¢',angry:'ðŸ˜ '};const MOOD_COLORS={happy:'var(--chart-color-mood-happy)',sad:'var(--chart-color-mood-sad)',angry:'var(--chart-color-mood-angry)'};const MOOD_BACKGROUNDS={happy:'var(--chart-color-mood-happy-bg)',sad:'var(--chart-color-mood-sad-bg)',angry:'var(--chart-color-mood-angry-bg)'};const DAYS_OF_WEEK=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];// Separate configurations for clarity\nconst CHART_CONFIGS={normal:{svgWidth:350,svgHeight:300,cellWidth:50,cellHeight:44,dayLabelY:30,dayLabelFontSize:9,dateLabelX:5,dateLabelY:12,dateLabelFontSize:8,moodIconFontSize:20,startX:25,startY:55},expanded:{svgWidth:700,svgHeight:600,cellWidth:100,cellHeight:85,dayLabelY:55,dayLabelFontSize:16,dateLabelX:12,dateLabelY:22,dateLabelFontSize:14,moodIconFontSize:36,startX:50,startY:100}};const getCalendarConfig=isExpanded=>{return isExpanded?CHART_CONFIGS.expanded:CHART_CONFIGS.normal;};// --- Helper Functions ---\nconst normalizeMood=mood=>mood&&MOODS[mood.toLowerCase()]?mood.toLowerCase():null;const getMoodEmoji=mood=>MOODS[normalizeMood(mood)];const getMoodColor=mood=>MOOD_COLORS[normalizeMood(mood)];const getMoodBackgroundColor=mood=>MOOD_BACKGROUNDS[normalizeMood(mood)]||'#ffffff';const moodLegendItems=Object.entries(MOODS).map(_ref=>{let[mood,emoji]=_ref;return{icon:emoji,label:mood.charAt(0).toUpperCase()+mood.slice(1),style:{backgroundColor:MOOD_BACKGROUNDS[mood],borderColor:MOOD_COLORS[mood]}};});// --- Sub-components ---\nconst CalendarHeader=_ref2=>{let{config}=_ref2;return/*#__PURE__*/_jsx(\"g\",{className:\"calendar-header\",children:DAYS_OF_WEEK.map((day,i)=>/*#__PURE__*/_jsx(\"text\",{x:config.startX+i*config.cellWidth,y:config.dayLabelY,className:\"day-name-label\",style:{fontSize:config.dayLabelFontSize},children:day},day))});};const DayCell=_ref3=>{let{config,date,moods}=_ref3;const dayOfMonth=date.getDate();const dayOfWeek=date.getDay();const weekOfMonth=Math.floor((dayOfMonth-1+(()=>{const firstDay=new Date(date.getFullYear(),date.getMonth(),1);return!isNaN(firstDay.getTime())?firstDay.getDay():0;})())/7);const x=config.startX+dayOfWeek*config.cellWidth;const y=config.startY+weekOfMonth*(config.cellHeight+2);const primaryMood=moods.length>0?moods[0]:null;return/*#__PURE__*/_jsxs(\"g\",{className:\"day-cell-group\",transform:\"translate(\".concat(x-config.cellWidth/2,\", \").concat(y-config.cellHeight/2,\")\"),children:[/*#__PURE__*/_jsx(\"rect\",{width:config.cellWidth,height:config.cellHeight,fill:getMoodBackgroundColor(primaryMood),className:\"day-cell-bg\"}),/*#__PURE__*/_jsx(\"text\",{x:config.dateLabelX,y:config.dateLabelY,className:\"date-label\",style:{fontSize:config.dateLabelFontSize},children:dayOfMonth}),primaryMood&&/*#__PURE__*/_jsx(\"text\",{x:config.cellWidth/2,y:config.cellHeight*0.65,className:\"mood-icon\",fill:getMoodColor(primaryMood),style:{fontSize:config.moodIconFontSize},children:getMoodEmoji(primaryMood)})]});};const Calendar=_ref4=>{let{isExpanded,moodByDate,currentMonth,monthDisplay}=_ref4;const config=getCalendarConfig(isExpanded);const year=currentMonth.getFullYear();const month=currentMonth.getMonth();const daysInMonth=(()=>{const lastDay=new Date(year,month+1,0);return!isNaN(lastDay.getTime())?lastDay.getDate():30;})();return/*#__PURE__*/_jsxs(\"div\",{className:\"mood-calendar-svg-container\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"chart-title\",children:\"Mood Calendar\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"chart-subtitle\",children:monthDisplay}),/*#__PURE__*/_jsxs(\"svg\",{viewBox:\"0 0 \".concat(config.svgWidth,\" \").concat(config.svgHeight),className:\"mood-calendar-svg\",children:[/*#__PURE__*/_jsx(\"rect\",{width:config.svgWidth,height:config.svgHeight,fill:\"white\"}),/*#__PURE__*/_jsx(CalendarHeader,{config:config}),/*#__PURE__*/_jsx(\"g\",{className:\"calendar-body\",children:[...Array(daysInMonth)].map((_,i)=>{const dayOfMonth=i+1;const date=new Date(year,month,dayOfMonth);return/*#__PURE__*/_jsx(DayCell,{config:config,date:date,moods:moodByDate[dayOfMonth]||[]},i);})})]})]});};// --- Main Component ---\nconst MoodCalendar=_ref5=>{let{patientId,isExpanded=false,onExpand,viewMode='patient',navigation,screenshotMode=false,showThreeMonthSummaries=false}=_ref5;const{moodData,isLoading:loading,error}=usePatientData(patientId,'mood');// Use navigation from parent or fallback to internal navigation\nconst useInternalNavigation=!navigation;const internalNavigation=useChartNavigation('mood');const nav=navigation||internalNavigation;// For mood chart, determine the month to display based on the navigation\n// If using weekly navigation, show the month that contains the current week\nlet currentMonth;if(nav.navigationType==='week'){// Use the week's start date to determine which month to display\nconst weekRange=nav.getDateRange();currentMonth=new Date(weekRange.start.getFullYear(),weekRange.start.getMonth(),1);}else{// Use monthly navigation directly\ncurrentMonth=nav.currentDate;}const moodByDate=moodData.filter(d=>d.date.getFullYear()===currentMonth.getFullYear()&&d.date.getMonth()===currentMonth.getMonth()).reduce((acc,item)=>{const dateKey=item.date.getDate();if(!acc[dateKey])acc[dateKey]=[];acc[dateKey].push(item.mood);return acc;},{});// Get appropriate month display based on navigation type\nconst monthDisplay=nav.navigationType==='week'?currentMonth.toLocaleDateString('en-US',{month:'long',year:'numeric'}):nav.getFormattedDateRange();// Get 3-month data\nconst{start:startOfThreeMonths,end:endOfThreeMonths}=nav.getThreeMonthRange();const threeMonthData=moodData.filter(d=>d.date>=startOfThreeMonths&&d.date<=endOfThreeMonths);// Calculate summary statistics for physician view\nconst currentMonthData=moodData.filter(d=>d.date.getFullYear()===currentMonth.getFullYear()&&d.date.getMonth()===currentMonth.getMonth());let monthSummary=null;if(currentMonthData.length>0){// Count mood occurrences\nconst moodCounts={};Object.keys(MOODS).forEach(mood=>{moodCounts[mood]=0;});currentMonthData.forEach(entry=>{const normalizedMood=normalizeMood(entry.mood);if(normalizedMood&&moodCounts[normalizedMood]!==undefined){moodCounts[normalizedMood]++;}});// Find most common mood\nconst mostCommonMood=Object.entries(moodCounts).sort((_ref6,_ref7)=>{let[,a]=_ref6;let[,b]=_ref7;return b-a;})[0];// Calculate mood distribution percentages\nconst totalEntries=currentMonthData.length;const moodPercentages={};Object.entries(moodCounts).forEach(_ref8=>{let[mood,count]=_ref8;moodPercentages[mood]=totalEntries>0?(count/totalEntries*100).toFixed(0):0;});// Days in current month\nconst daysInMonth=(()=>{const lastDay=new Date(currentMonth.getFullYear(),currentMonth.getMonth()+1,0);return!isNaN(lastDay.getTime())?lastDay.getDate():30;})();const daysWithMood=new Set(currentMonthData.map(d=>d.date.getDate())).size;// Calculate mood score (happy=3, sad=1, angry=1)\nconst moodScore=(moodCounts.happy*3+moodCounts.sad*1+moodCounts.angry*1)/totalEntries;const moodTrend=moodScore>=2.5?'Positive':moodScore>=1.5?'Mixed':'Needs Attention';monthSummary={totalEntries,daysWithMood,daysInMonth,mostCommonMood:mostCommonMood[0],mostCommonMoodCount:mostCommonMood[1],moodCounts,moodPercentages,moodTrend};}// Calculate 3-month summary statistics for physician view\nlet threeMonthSummary=null;if(threeMonthData.length>0){// Count mood occurrences\nconst moodCounts={};Object.keys(MOODS).forEach(mood=>{moodCounts[mood]=0;});threeMonthData.forEach(entry=>{const normalizedMood=normalizeMood(entry.mood);if(normalizedMood&&moodCounts[normalizedMood]!==undefined){moodCounts[normalizedMood]++;}});// Find most common mood\nconst mostCommonMood=Object.entries(moodCounts).sort((_ref9,_ref0)=>{let[,a]=_ref9;let[,b]=_ref0;return b-a;})[0];// Calculate mood distribution percentages\nconst totalEntries=threeMonthData.length;const moodPercentages={};Object.entries(moodCounts).forEach(_ref1=>{let[mood,count]=_ref1;moodPercentages[mood]=totalEntries>0?(count/totalEntries*100).toFixed(0):0;});// Calculate actual days in the 3-month period\nconst{start:startOfThreeMonths,end:endOfThreeMonths}=nav.getThreeMonthRange();const daysInThreeMonths=Math.ceil((endOfThreeMonths-startOfThreeMonths)/(1000*60*60*24))+1;const daysWithMood=new Set(threeMonthData.map(d=>d.date.toDateString())).size;// Calculate mood score (happy=3, sad=1, angry=1)\nconst moodScore=(moodCounts.happy*3+moodCounts.sad*1+moodCounts.angry*1)/totalEntries;const moodTrend=moodScore>=2.5?'Positive':moodScore>=1.5?'Mixed':'Needs Attention';threeMonthSummary={totalEntries,daysWithMood,daysInThreeMonths,mostCommonMood:mostCommonMood[0],mostCommonMoodCount:mostCommonMood[1],moodCounts,moodPercentages,moodTrend};}return/*#__PURE__*/_jsxs(\"div\",{className:\"mood-calendar-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mood-calendar-wrapper \".concat(isExpanded?'expanded':''),children:/*#__PURE__*/_jsx(Calendar,{isExpanded:isExpanded,moodByDate:moodByDate,currentMonth:currentMonth,monthDisplay:monthDisplay})}),/*#__PURE__*/_jsx(\"div\",{className:\"mood-calendar-legend-wrapper\",children:/*#__PURE__*/_jsx(Legend,{title:\"Mood\",items:moodLegendItems,hide:screenshotMode})}),(viewMode==='physician'||viewMode==='unified')&&monthSummary&&/*#__PURE__*/_jsxs(\"div\",{className:\"summary-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chart-summary\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Month Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-stats\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Mood Entries:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[monthSummary.totalEntries,\" entries\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Most Common Mood:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[MOODS[monthSummary.mostCommonMood],\" \",monthSummary.mostCommonMood.charAt(0).toUpperCase()+monthSummary.mostCommonMood.slice(1),\" (\",monthSummary.mostCommonMoodCount,\"x)\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Mood Distribution:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[\"\\uD83D\\uDE0A\",monthSummary.moodPercentages.happy,\"% \\uD83D\\uDE22\",monthSummary.moodPercentages.sad,\"% \\uD83D\\uDE20\",monthSummary.moodPercentages.angry,\"%\"]})]})]})]}),showThreeMonthSummaries&&threeMonthSummary&&/*#__PURE__*/_jsxs(\"div\",{className:\"chart-summary\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"3-Month Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-stats\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Mood Entries:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[threeMonthSummary.totalEntries,\" entries\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Most Common Mood:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[MOODS[threeMonthSummary.mostCommonMood],\" \",threeMonthSummary.mostCommonMood.charAt(0).toUpperCase()+threeMonthSummary.mostCommonMood.slice(1),\" (\",threeMonthSummary.mostCommonMoodCount,\"x)\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Mood Distribution:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[\"\\uD83D\\uDE0A\",threeMonthSummary.moodPercentages.happy,\"% \\uD83D\\uDE22\",threeMonthSummary.moodPercentages.sad,\"% \\uD83D\\uDE20\",threeMonthSummary.moodPercentages.angry,\"%\"]})]})]})]})]})]});};export default MoodCalendar;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}