{"ast":null,"code":"/**\n PainChart.js - Pain Assessment and Visualization Component\n \n This component provides comprehensive pain monitoring:\n - Anatomical body mapping for pain location\n - Pain intensity scale (0-10) with color coding\n - Daily pain tracking and trend analysis\n - Interactive body diagram for pain location selection\n - Pain level input and editing capabilities\n - Navigation controls for time periods\n \n Critical for pain management and treatment monitoring.\n */import React,{useState,useRef}from'react';import usePatientData from'../../hooks/usePatientData';import useChartNavigation from'../../hooks/useChartNavigation';import Legend from'../Legend';import'./PainChart.css';import BodySVG from'./BodySvg';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const PainChart=_ref=>{let{patientId,isExpanded=false,onExpand,viewMode='patient',navigation,screenshotMode=false,showThreeMonthSummaries=false}=_ref;const{painData,isLoading:loading,error}=usePatientData(patientId,'pain');const[useLineChart,setUseLineChart]=useState(false);// Toggle state for chart view\n// Use navigation from parent or fallback to internal navigation\nconst useInternalNavigation=!navigation;const internalNavigation=useChartNavigation('pain');const nav=navigation||internalNavigation;const getPainColor=level=>{// 11-class color scheme from light to dark\nconst painColors=['#ffffe5',// 0 - No pain (lightest cream)\n'#fff7bc',// 1 - Very mild pain\n'#f7f7b3',// 2 - Mild pain\n'#fee391',// 3 - Mild-moderate pain\n'#fec44f',// 4 - Moderate pain\n'#fe9929',// 5 - Moderate-severe pain\n'#ec7014',// 6 - Severe pain\n'#cc4c02',// 7 - Very severe pain\n'#b34703',// 8 - Extremely severe pain\n'#993404',// 9 - Most severe pain\n'#662506'// 10 - Maximum pain (darkest brown)\n];return painColors[Math.min(level,10)];};const painLegendItems=Array.from({length:11},(_,i)=>i).map(level=>({color:getPainColor(level),label:\"\".concat(level)}));const{start:startOfWeek,end:endOfWeek}=nav.getDateRange();// Calculate previous and next week ranges\nconst prevWeekStart=new Date(startOfWeek);prevWeekStart.setDate(prevWeekStart.getDate()-7);const prevWeekEnd=new Date(prevWeekStart);prevWeekEnd.setDate(prevWeekEnd.getDate()+6);prevWeekEnd.setHours(23,59,59,999);const nextWeekStart=new Date(endOfWeek);nextWeekStart.setDate(nextWeekStart.getDate()+1);nextWeekStart.setHours(0,0,0,0);const nextWeekEnd=new Date(nextWeekStart);nextWeekEnd.setDate(nextWeekEnd.getDate()+6);nextWeekEnd.setHours(23,59,59,999);const weekPainData=painData.filter(d=>d.date>=startOfWeek&&d.date<=endOfWeek);const prevWeekPainData=painData.filter(d=>d.date>=prevWeekStart&&d.date<=prevWeekEnd);const nextWeekPainData=painData.filter(d=>d.date>=nextWeekStart&&d.date<=nextWeekEnd);// Get 3-month data\nconst{start:startOfThreeMonths,end:endOfThreeMonths}=nav.getThreeMonthRange();const threeMonthPainData=painData.filter(d=>d.date>=startOfThreeMonths&&d.date<=endOfThreeMonths);// Helper functions for data processing\nconst processPainData=painData=>{const dateMap={};const locationCounts={};painData.forEach(item=>{const dateKey=item.date.toDateString();dateMap[dateKey]=item.level;const location=item.location.toLowerCase();locationCounts[location]=(locationCounts[location]||0)+1;});return{dateMap,locationCounts};};const findMostCommonLocation=locationCounts=>{let mostCommon=null;let maxCount=0;Object.entries(locationCounts).forEach(_ref2=>{let[location,count]=_ref2;if(count>maxCount){maxCount=count;mostCommon=location;}});return mostCommon;};const createWeekChartData=(dateMap,startOfWeek)=>{const data=[];const dayNames=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];for(let i=0;i<7;i++){const date=new Date(startOfWeek);date.setDate(date.getDate()+i);const dateKey=date.toDateString();const painLevel=dateMap[dateKey]||0;data.push({date,day:dayNames[date.getDay()],level:painLevel,color:getPainColor(painLevel)});}return data;};const calculateAveragePain=painData=>{if(painData.length===0)return 0;const totalPain=painData.reduce((sum,item)=>sum+item.level,0);return totalPain/painData.length;};// Process data for chart\nlet chartData=[];let mostCommonLocation=null;let averagePainLevel=0;if(weekPainData.length>0){const{dateMap,locationCounts}=processPainData(weekPainData);mostCommonLocation=findMostCommonLocation(locationCounts);chartData=createWeekChartData(dateMap,startOfWeek);averagePainLevel=calculateAveragePain(weekPainData);}const createExtendedChartData=()=>{const allWeeksData=[...prevWeekPainData,...weekPainData,...nextWeekPainData];const dateMap={};allWeeksData.forEach(item=>{const dateKey=item.date.toDateString();dateMap[dateKey]=item.level;});const data=[];const weekLabels=['Prev Week','Current Week','Next Week'];const weekStarts=[prevWeekStart,startOfWeek,nextWeekStart];const dayNames=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];for(let week=0;week<3;week++){const weekStart=weekStarts[week];for(let day=0;day<7;day++){const date=new Date(weekStart);date.setDate(date.getDate()+day);const dateKey=date.toDateString();const painLevel=dateMap[dateKey]||0;data.push({date,day:dayNames[date.getDay()],level:painLevel,color:getPainColor(painLevel),week:week,weekLabel:weekLabels[week]});}}return data;};// Process data for extended chart (3 weeks)\nconst extendedChartData=isExpanded?createExtendedChartData():[];// Calculate 3-month summary statistics for physician view\nlet threeMonthSummary=null;if(threeMonthPainData.length>0){// Create a map of dates to pain levels for 3-month period\nconst dateMap=new Map();const locationCounts=new Map();threeMonthPainData.forEach(item=>{const dateKey=item.date.toDateString();dateMap.set(dateKey,item.level);// Count locations\nconst location=item.location.toLowerCase();locationCounts.set(location,(locationCounts.get(location)||0)+1);});// Find most common location\nlet mostCommon=null;let maxCount=0;for(const[location,count]of locationCounts){if(count>maxCount){maxCount=count;mostCommon=location;}}const totalPain=threeMonthPainData.reduce((sum,item)=>sum+item.level,0);const avgPain=threeMonthPainData.length>0?totalPain/threeMonthPainData.length:0;// Calculate actual days in the 3-month period\nconst{start:startOfThreeMonths,end:endOfThreeMonths}=nav.getThreeMonthRange();const daysInThreeMonths=Math.ceil((endOfThreeMonths-startOfThreeMonths)/(1000*60*60*24))+1;const daysWithPain=new Set(threeMonthPainData.map(d=>d.date.toDateString())).size;// Calculate pain severity distribution\nconst painLevelCounts={};for(let i=0;i<=10;i++){painLevelCounts[i]=0;}threeMonthPainData.forEach(item=>{painLevelCounts[item.level]++;});// Find most common pain level\nconst mostCommonPainLevel=Object.entries(painLevelCounts).sort((_ref3,_ref4)=>{let[,a]=_ref3;let[,b]=_ref4;return b-a;})[0];threeMonthSummary={totalEntries:threeMonthPainData.length,daysWithPain,daysInThreeMonths,mostCommonLocation:mostCommon,mostCommonLocationCount:maxCount,averagePainLevel:avgPain,mostCommonPainLevel:parseInt(mostCommonPainLevel[0]),mostCommonPainLevelCount:mostCommonPainLevel[1]};}const formatDateRange=(start,end)=>{const startStr=start.toLocaleDateString('en-US',{month:'short',day:'numeric'});const endStr=end.toLocaleDateString('en-US',{month:'short',day:'numeric'});return\"\".concat(startStr,\" to \").concat(endStr);};// Line Chart Component for Pain Ratings\nconst PainLineChart=_ref5=>{let{data,isExpanded,extendedData}=_ref5;const isExtendedView=isExpanded&&extendedData&&extendedData.length>0;const chartData=isExtendedView?extendedData:data;const config={width:isExtendedView?900:isExpanded?600:400,// Wider for 3-week view\nheight:isExpanded?220:150,// Reduced height since we removed week labels\npadding:{top:20,right:30,bottom:50,left:50},// Reduced bottom padding\nyAxisRange:10,fontSize:{yAxis:isExpanded?10:8,xAxis:isExpanded?10:8}};const chartWidth=config.width-config.padding.left-config.padding.right;const chartHeight=config.height-config.padding.top-config.padding.bottom;const dayWidth=chartWidth/(chartData.length-1);// Dynamic based on data length\n// Create line path\nconst linePath=chartData.map((point,index)=>{const x=config.padding.left+index*dayWidth;const y=config.padding.top+chartHeight-point.level/config.yAxisRange*chartHeight;return\"\".concat(index===0?'M':'L',\" \").concat(x,\" \").concat(y);}).join(' ');return/*#__PURE__*/_jsx(\"div\",{className:\"pain-line-chart\",children:/*#__PURE__*/_jsxs(\"svg\",{width:\"100%\",height:\"100%\",viewBox:\"0 0 \".concat(config.width,\" \").concat(config.height),children:[[0,2,4,6,8,10].map(level=>{const y=config.padding.top+chartHeight-level/config.yAxisRange*chartHeight;return/*#__PURE__*/_jsxs(\"g\",{children:[/*#__PURE__*/_jsx(\"line\",{x1:config.padding.left,y1:y,x2:config.width-config.padding.right,y2:y,stroke:\"#e0e0e0\",strokeWidth:\"1\",strokeDasharray:\"2,2\"}),/*#__PURE__*/_jsx(\"text\",{x:config.padding.left-10,y:y+3,fontSize:config.fontSize.yAxis,textAnchor:\"end\",fill:\"var(--chart-color-text-secondary)\",children:level})]},level);}),isExtendedView&&[7,14].map(weekIndex=>{const x=config.padding.left+weekIndex*dayWidth;return/*#__PURE__*/_jsx(\"line\",{x1:x,y1:config.padding.top,x2:x,y2:config.height-config.padding.bottom,stroke:\"#ccc\",strokeWidth:\"2\",strokeDasharray:\"5,5\"},weekIndex);}),chartData.map((point,index)=>{const x=config.padding.left+index*dayWidth;const showLabel=isExtendedView?index%7===0:true;// Show every 7th day for extended view\nconst dateStr=point.date.toLocaleDateString('en-US',{month:'short',day:'numeric'});return/*#__PURE__*/_jsx(\"g\",{children:showLabel&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"text\",{x:x,y:config.height-config.padding.bottom+15,fontSize:config.fontSize.xAxis,textAnchor:\"middle\",className:\"x-axis-day-label\",children:point.day}),/*#__PURE__*/_jsx(\"text\",{x:x,y:config.height-config.padding.bottom+30,fontSize:config.fontSize.xAxis-1,textAnchor:\"middle\",className:\"x-axis-date-label\",fill:\"var(--chart-color-text-secondary)\",children:dateStr})]})},index);}),/*#__PURE__*/_jsx(\"path\",{d:linePath,stroke:\"var(--chart-color-primary)\",strokeWidth:\"3\",fill:\"none\"}),chartData.map((point,index)=>{const x=config.padding.left+index*dayWidth;const y=config.padding.top+chartHeight-point.level/config.yAxisRange*chartHeight;return/*#__PURE__*/_jsx(\"circle\",{cx:x,cy:y,r:\"4\",fill:point.color,stroke:\"var(--chart-color-primary)\",strokeWidth:\"2\"},index);})]})});};const Body=_ref6=>{let{location,level}=_ref6;const color=getPainColor(level);const locationLower=location.toLowerCase();return/*#__PURE__*/_jsx(\"div\",{className:\"body-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"body-views\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"body-view\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"body-view-label\",children:\"Front\"}),/*#__PURE__*/_jsx(BodySVG,{className:\"body-svg\",painLocation:locationLower,painColor:color,view:\"front\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"body-view\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"body-view-label\",children:\"Back\"}),/*#__PURE__*/_jsx(BodySVG,{className:\"body-svg\",painLocation:locationLower,painColor:color,view:\"back\"})]})]})});};if(viewMode==='patient'){return/*#__PURE__*/_jsxs(\"div\",{className:\"pain-chart-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pain-chart-header\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"chart-title\",children:\"Pain\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"chart-subtitle\",children:nav.getFormattedDateRange()}),/*#__PURE__*/_jsxs(\"div\",{className:\"view-toggle\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"toggle-btn \".concat(!useLineChart?'active':''),onClick:()=>setUseLineChart(false),children:\"List View\"}),/*#__PURE__*/_jsx(\"button\",{className:\"toggle-btn \".concat(useLineChart?'active':''),onClick:()=>setUseLineChart(true),children:\"Line Chart\"})]})]}),useLineChart?/*#__PURE__*/_jsxs(\"div\",{className:\"pain-line-chart-container\",children:[/*#__PURE__*/_jsx(PainLineChart,{data:chartData,isExpanded:isExpanded,extendedData:extendedChartData}),/*#__PURE__*/_jsx(\"div\",{className:\"pain-legend-wrapper\",children:/*#__PURE__*/_jsx(Legend,{title:\"Pain Intensity Scale (0-10)\",items:painLegendItems,hide:screenshotMode})})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"pain-content-wrapper\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pain-list\",children:weekPainData.length>0?weekPainData.map((item,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"pain-list-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pain-item-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pain-item-date\",children:new Date(item.date).toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'})}),/*#__PURE__*/_jsxs(\"div\",{className:\"pain-item-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pain-level\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Pain Level:\"}),\" \",item.level,\"/10\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pain-location\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Location:\"}),\" \",item.location]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"pain-item-body\",children:/*#__PURE__*/_jsx(Body,{location:item.location,level:item.level})})]},index)):/*#__PURE__*/_jsx(\"div\",{className:\"no-pain-data\",children:\"No pain data available for this week\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"pain-legend-wrapper\",children:/*#__PURE__*/_jsx(Legend,{title:\"Pain Intensity Scale (0-10)\",items:painLegendItems,hide:screenshotMode})})]})]});}// Physician/Unified view\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"physician-pain-chart-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pain-chart-header\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"chart-title\",children:\"Pain\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"chart-subtitle\",children:nav.getFormattedDateRange()}),/*#__PURE__*/_jsxs(\"div\",{className:\"view-toggle\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"toggle-btn \".concat(!useLineChart?'active':''),onClick:()=>setUseLineChart(false),children:\"List View\"}),/*#__PURE__*/_jsx(\"button\",{className:\"toggle-btn \".concat(useLineChart?'active':''),onClick:()=>setUseLineChart(true),children:\"Line Chart\"})]})]}),useLineChart?/*#__PURE__*/_jsxs(\"div\",{className:\"pain-line-chart-container\",children:[/*#__PURE__*/_jsx(PainLineChart,{data:chartData,isExpanded:isExpanded,extendedData:extendedChartData}),/*#__PURE__*/_jsx(\"div\",{className:\"pain-location-info\",children:/*#__PURE__*/_jsxs(\"h4\",{children:[\"Pain Location: \",mostCommonLocation||'N/A']})}),/*#__PURE__*/_jsx(\"div\",{className:\"pain-legend-wrapper\",children:/*#__PURE__*/_jsx(Legend,{title:\"Pain Intensity Scale (0-10)\",items:painLegendItems})})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"pain-content-wrapper\",children:[mostCommonLocation&&/*#__PURE__*/_jsxs(\"div\",{className:\"main-pain-visualization\",children:[/*#__PURE__*/_jsxs(\"h4\",{children:[\"Most Common Pain Location: \",mostCommonLocation]}),/*#__PURE__*/_jsx(Body,{location:mostCommonLocation,level:Math.round(averagePainLevel)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"pain-list\",children:weekPainData.length>0?weekPainData.map((item,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"pain-list-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pain-item-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pain-item-date\",children:new Date(item.date).toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'})}),/*#__PURE__*/_jsxs(\"div\",{className:\"pain-item-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pain-level\",children:[\"Pain Level: \",/*#__PURE__*/_jsxs(\"span\",{style:{color:getPainColor(item.level)},children:[item.level,\"/10\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pain-location\",children:[\"Location: \",item.location||'Not specified']})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"pain-item-body\",children:/*#__PURE__*/_jsx(Body,{location:item.location,level:item.level})})]},index)):/*#__PURE__*/_jsx(\"div\",{className:\"no-pain-data\",children:\"No pain data available for this week\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"pain-legend-wrapper\",children:/*#__PURE__*/_jsx(Legend,{title:\"Pain Intensity Scale (0-10)\",items:painLegendItems,hide:screenshotMode})})]}),(viewMode==='physician'||viewMode==='unified')&&/*#__PURE__*/_jsxs(\"div\",{className:\"summary-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chart-summary\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Week Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-stats\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Average Pain Intensity:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[averagePainLevel.toFixed(1),\"/10\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Most Common Location:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"stat-value\",children:mostCommonLocation||'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Days with Pain:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[weekPainData.length,\"/7\"]})]})]})]}),showThreeMonthSummaries&&threeMonthSummary&&/*#__PURE__*/_jsxs(\"div\",{className:\"chart-summary\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"3-Month Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-stats\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Average Pain Intensity:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[threeMonthSummary.averagePainLevel.toFixed(1),\"/10\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Most Common Location:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[threeMonthSummary.mostCommonLocation||'N/A',\" (\",threeMonthSummary.mostCommonLocationCount,\"x)\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Days with Pain:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[threeMonthSummary.daysWithPain,\"/\",threeMonthSummary.daysInThreeMonths]})]})]})]})]})]});};export default PainChart;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}